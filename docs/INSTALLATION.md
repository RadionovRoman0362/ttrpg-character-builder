# Полная Инструкция по Установке и Настройке

Этот документ содержит подробные шаги для настройки вашей локальной рабочей среды и запуска проекта **TTRPG Character Builder**. Мы будем использовать **Windows 11** с **WSL 2** и **Docker** для изоляции окружения.

---

## 1. Установка Необходимого Программного Обеспечения

Прежде чем клонировать проект, убедитесь, что у вас установлены следующие инструменты.

### 1.1. Включение и установка WSL 2 (Windows Subsystem for Linux)

WSL 2 необходим для Docker Desktop и обеспечивает лучшую производительность Linux-контейнеров на Windows.

1.  Откройте **PowerShell от имени администратора** (`Win + X` -> "Терминал (Администратор)" или "Windows PowerShell (Администратор)").
2.  Выполните команду:
    ```powershell
    wsl --install
    ```
    Эта команда автоматически включит необходимые компоненты Windows, скачает ядро Linux и установит дистрибутив Ubuntu по умолчанию.
3.  **Обязательно перезагрузите компьютер** после завершения установки.

### 1.2. Установка Docker Desktop

Docker Desktop — это основной инструмент для управления контейнерами.

1.  Скачайте и установите Docker Desktop с официального сайта: [docker.com/products/docker-desktop](https://www.docker.com/products/docker-desktop).
2.  В процессе установки **убедитесь, что выбрана опция "Use WSL 2 instead of Hyper-V (recommended)"**.
3.  После установки запустите Docker Desktop. Убедитесь, что он успешно работает (зеленая иконка в левом нижнем углу).

### 1.3. Установка Git

Git — система контроля версий.

1.  Скачайте и установите Git for Windows с официального сайта: [git-scm.com/download/win](https://git-scm.com/download/win).
2.  На всех шагах установки можно оставлять значения по умолчанию.

### 1.4. Установка Visual Studio Code и Расширений

VS Code — ваш основной редактор кода.

1.  Скачайте и установите VS Code с официального сайта: [code.visualstudio.com](https://code.visualstudio.com/).
2.  Запустите VS Code и установите следующие расширения (перейдите в раздел расширений `Ctrl+Shift+X`):
    *   `Python` (от Microsoft)
    *   `Docker` (от Microsoft)
    *   `Remote - WSL` (от Microsoft) - **Критически важно!** Позволяет VS Code работать с файлами внутри WSL.

---

## 2. Клонирование Проекта и Подготовка Окружения

### 2.1. Клонируйте репозиторий в WSL

**Важно:** Проект необходимо клонировать **внутри файловой системы WSL**, а не напрямую в Windows (например, не в `C:\Users\YourUser\Documents\Projects`). Это обеспечивает максимальную производительность и корректную работу с Docker.

1.  Откройте **Терминал WSL** (например, через Windows Terminal, выбрав Ubuntu). Вы попадете в домашнюю директорию вашего пользователя Linux (обычно `/home/<ваш_пользователь>`).
2.  Перейдите в удобное для вас место внутри файловой системы WSL (например, в папку для проектов):
    ```bash
    cd ~/projects # Если папки projects нет, создайте ее: mkdir ~/projects && cd ~/projects
    ```
    *Примечание: Символ `~` означает вашу домашнюю директорию в Linux.*
3.  Клонируйте репозиторий проекта (замените `<URL_вашего_репозитория>` на актуальный URL с GitHub):
    ```bash
    git clone <URL_вашего_репозитория>
    ```
4.  Перейдите в папку проекта:
    ```bash
    cd ttrpg-character-builder
    ```

### 2.2. Откройте проект в VS Code в режиме WSL

Находясь в папке проекта в **Терминале WSL**, выполните:

```bash
code .
```
VS Code откроется. В левом нижнем углу убедитесь, что отображается `>< WSL: Ubuntu`. Если VS Code предложит "Reopen in WSL", подтвердите. Это гарантирует, что вы работаете в правильном режиме.

### 2.3. Создайте файл `.env`

Проект использует переменные окружения, которые подгружаются из файла `.env`.

1.  В корневой папке проекта найдите файл `.env.example`.
2.  Скопируйте его и назовите копию `.env`.
    ```bash
    cp .env.example .env
    ```
    *Файл `.env` не будет отслеживаться Git'ом (он добавлен в `.gitignore`). Вы можете изменить значения в `.env`, если это необходимо, но для первого запуска стандартных значений достаточно.*

---

## 3. Запуск и Настройка Проекта

### 3.1. Соберите и запустите Docker-контейнеры

Эта команда скачает необходимые образы, соберет образ для вашего Django-приложения (установив все зависимости из `requirements.txt`) и запустит оба контейнера в фоновом режиме.

1.  В **Терминале VS Code (в режиме WSL)** выполните:
    ```bash
    docker-compose up --build -d
    ```
    *   Флаг `--build` заставит Docker пересобрать образы, гарантируя установку всех зависимостей.
    *   Флаг `-d` (detached) запустит контейнеры в фоновом режиме, освобождая терминал.

### 3.2. Примените миграции базы данных

Эта команда создаст все необходимые таблицы в базе данных PostgreSQL, используя наши модели Django.

1.  В том же терминале выполните:
    ```bash
    docker-compose exec web python manage.py migrate
    ```

### 3.3. Создайте суперпользователя

Для доступа к админ-панели Django вам понадобится учетная запись с правами администратора.

1.  В том же терминале выполните:
    ```bash
    docker-compose exec web python manage.py createsuperuser
    ```
2.  Следуйте инструкциям в консоли, чтобы задать `Username`, `Email address` и `Password`. Пароль при вводе не будет отображаться.

### 3.4. Загрузите начальные данные (сиды)

Эта команда наполнит вашу базу данных базовыми правилами для системы Daggerheart.

1.  В том же терминале выполните:
    ```bash
    docker-compose exec web python manage.py load_system_data data/seeds/daggerheart_1_0.json
    ```
    Вы увидите логи загрузки данных.

---

## 4. Настройка Инструментов Качества Кода (Локально)

Для поддержания единого стиля кода и предотвращения ошибок мы используем `pre-commit` хуки. **Эту настройку должен выполнить каждый разработчик один раз.**

1.  **Установите `pre-commit`:**
    Если у вас не установлен `pre-commit` локально (в вашем WSL-окружении), установите его с помощью `pip`:
    ```bash
    pip install pre-commit
    ```
    *Примечание: `black` и `flake8` будут установлены автоматически самим `pre-commit` в изолированное окружение, их глобальная установка не обязательна.*

2.  **Активируйте хуки в репозитории:**
    Находясь в корневой папке проекта в **Терминале WSL**, выполните команду:
    ```bash
    pre-commit install
    ```
    Эта команда установит Git-хуки в вашу локальную папку `.git`.

Теперь, при каждой попытке выполнить `git commit`, `pre-commit` сначала запустит `black` для автоматического форматирования ваших `.py` файлов, а затем `flake8` для проверки на наличие ошибок. Если `black` изменит файлы, вам нужно будет снова их добавить (`git add .`) и повторить коммит. Если `flake8` найдет ошибки, коммит будет отклонен до тех пор, пока вы их не исправите.

### **Первое форматирование всей кодовой базы**

Поскольку вы только что настроили `pre-commit`, в вашем репозитории могут быть файлы, которые не соответствуют стандартам форматирования. Чтобы привести всю кодовую базу в порядок один раз:

1.  Выполните команду:
    ```bash
    pre-commit run --all-files
    ```
    `black` автоматически отформатирует все файлы. `flake8` укажет на возможные ошибки.
2.  После выполнения этой команды, `git status` покажет, что много файлов было изменено.
3.  **Добавьте все эти изменения:** `git add .`
4.  **Сделайте коммит:** `git commit -m "style: Format codebase with black and fix linting issues"`
5.  **Отправьте коммит на GitHub:** `git push`

---

## 5. Проверка Работы Проекта

После выполнения всех вышеуказанных шагов проект будет полностью готов к работе.

*   **Главная страница Django:** Откройте ваш браузер и перейдите по адресу `http://localhost:8000/`. Вы должны увидеть стандартную страницу "The install worked successfully!".
*   **Админ-панель Django:** Перейдите по адресу `http://localhost:8000/admin/`. Используйте логин и пароль суперпользователя, которые вы создали на шаге 3.3. Вы должны увидеть все наши модели.
*   **Интерактивная API документация (Swagger UI):** Перейдите по адресу `http://localhost:8000/api/docs/`. Здесь вы найдете полное описание всех API-эндпоинтов, их параметров и ожидаемых ответов. Это основной ресурс для взаимодействия с бэкендом.

---

## 6. Полезные Команды Docker Compose

*   **Остановить проект (остановит и удалит контейнеры, но сохранит данные БД):**
    ```bash
    docker-compose down
    ```
*   **Остановить проект и удалить данные БД (полный сброс, будьте осторожны!):**
    ```bash
    docker-compose down -v
    ```
*   **Выполнить любую команду `manage.py` внутри контейнера `web`:**
    ```bash
    docker-compose exec web python manage.py <ваша_команда>
    # Например: docker-compose exec web python manage.py createsuperuser
    ```
*   **Посмотреть логи запущенных контейнеров в реальном времени:**
    ```bash
    docker-compose logs -f
    ```
*   **Пересобрать только один сервис (например, `web` после изменения `Dockerfile` или `requirements.txt`):**
    ```bash
    docker-compose build web
    docker-compose up -d web
    ```