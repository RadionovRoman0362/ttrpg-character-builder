# TTRPG Character Builder - API Documentation (v1)

Добро пожаловать в документацию по API для проекта "TTRPG Character Builder". Этот документ описывает основные эндпоинты, которые понадобятся для разработки клиентского приложения.

**Базовый URL:** `http://localhost:8000/api/v1`

## Аутентификация

На данный момент API использует аутентификацию по сессии (`sessionid` cookie). В будущем будет внедрена Token-based аутентификация.

Для получения `sessionid` и `csrftoken` во время локальной разработки:
1.  Откройте в браузере любой эндпоинт, требующий аутентификации (например, `{{base_url}}/sheets/`).
2.  Нажмите "Log in" в правом верхнем углу и войдите, используя учетные данные суперпользователя.
3.  Скопируйте значения `sessionid` и `csrftoken` из cookies вашего браузера.
4.  При отправке запросов, изменяющих данные (`POST`, `PUT`, `PATCH`, `DELETE`), необходимо передавать два заголовка:
    *   `Cookie`: `sessionid=<ваше_значение>`
    *   `X-CSRFToken`: `<ваше_значение>`

## Эндпоинты правил (`core`)

Эти эндпоинты предназначены только для чтения (`GET`).

### 1. Игровые системы

*   **`GET /systems/`**
    *   **Описание:** Возвращает список всех доступных игровых систем.
    *   **Пример ответа:**
      ```json
      {
        "count": 1,
        "results": [
          { "id": 1, "name": "Daggerheart", "version": "1.0", "slug": "daggerheart" }
        ]
      }
      ```

### 2. "Строительные блоки" персонажа (Traits)

*   **`GET /systems/{system_id}/traits/`**
    *   **Описание:** Возвращает список всех "строительных блоков" для конкретной системы.
    *   **Параметры запроса (Query Params):**
        *   `category` (string, optional): Фильтрует трейты по категории. Имена категорий для Daggerheart: `Class`, `Subclass`, `Ancestry`, `Community`.
        *   `name` (string, optional): Фильтрует по точному имени трейта.
    *   **Пример запроса (получить все классы Daggerheart):**
        `GET /systems/1/traits/?category=Class`
    *   **Пример ответа (сокращенно):**
      ```json
      {
        "count": 1,
        "results": [
          {
            "id": 1,
            "name": "Guardian",
            "description": "...",
            "category": { "id": 1, "name": "Class" },
            "parent": null,
            "children": [
              {
                "id": 2,
                "name": "Stalwart",
                "category": { "id": 2, "name": "Subclass" },
                ...
              }
            ],
            "features": [ { "id": 1, "name": "Frontline Tank", ... } ],
            "metadata": { "base_evasion": 8, ... }
          }
        ]
      }
      ```

### 3. Другие эндпоинты правил

*   **`GET /systems/{system_id}/features/`**: Получить все особенности для системы.
*   **`GET /systems/{system_id}/feature-sets/`**: Получить все наборы особенностей (Домены).
*   **`GET /systems/{system_id}/equipment-templates/`**: Получить все шаблоны предметов.

## Эндпоинты листов персонажей (`characters`)

Эти эндпоинты требуют аутентификации.

### 1. Список персонажей пользователя

*   **`GET /sheets/`**
    *   **Описание:** Возвращает список всех персонажей (краткая информация), принадлежащих текущему пользователю.

### 2. Создание нового персонажа

*   **`POST /sheets/`**
    *   **Описание:** Создает новый лист персонажа.
    *   **Тело запроса (JSON):**
      ```json
      {
        "name": "Имя Персонажа",
        "system": 1, // ID игровой системы
        "stats": { "level": 1 } // Минимально необходимые стартовые статы
      }
      ```

### 3. Просмотр, обновление, удаление персонажа

*   **`GET /sheets/{id}/`**
    *   **Описание:** Возвращает полную, вложенную информацию о конкретном персонаже.

*   **`PUT /sheets/{id}/`**
    *   **Описание:** Полностью заменяет данные персонажа. Необходимо передавать все поля.

*   **`PATCH /sheets/{id}/`**
    *   **Описание:** Частично обновляет данные персонажа. Можно передавать только измененные поля.
    *   **Пример тела запроса (выбор класса и распределение статов):**
      ```json
      {
        "traits": [1, 5, 8], // Массив ID выбранных CharacterTrait'ов
        "stats": {
          "level": 1,
          "agility": 1,
          "strength": 2,
          ...
        }
      }
      ```

*   **`DELETE /sheets/{id}/`**
    *   **Описание:** Удаляет лист персонажа.
